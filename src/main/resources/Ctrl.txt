package ${basePackage}.${pckNameLower}.ctrl;

import javax.validation.Valid;
import javax.validation.constraints.Max;
import javax.validation.constraints.Positive;
import javax.validation.constraints.PositiveOrZero;

import io.swagger.annotations.ApiOperation;
import io.swagger.annotations.ApiParam;
import io.swagger.v3.oas.annotations.tags.Tag;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;
import org.springframework.data.domain.Pageable;
import org.springframework.web.multipart.MultipartFile;
import java.io.IOException;
import org.springframework.http.HttpStatus;
import ${basePackageImport}.core.base.BaseController;
import ${basePackageImport}.core.util.SearchUtil;
import ${basePackageImport}.core.util.RequestUtil;
import ${basePackage}.${ettNameLower}.service.${pckFirstUpperCamel}CommonService;
import ${basePackageImport}.model.Paging;
import ${basePackageImport}.model.enumeration.SortOrderEnum;
import ${basePackageImport}.model.dto.exception.BusinessException;
import ${basePackageImport}.model.dto.SuccessResponse;
import ${basePackageImport}.model.dto.request.ApproveRequest;
import ${basePackageImport}.model.dto.response.UploadFileResponse;
import ${basePackageImport}.model.entity.${pckNameLower}.${pckFirstUpperCamel};
import ${basePackageImport}.model.dto.${pckNameLower}.Search${pckFirstUpperCamel}Request;
import ${basePackageImport}.model.dto.${pckNameLower}.${pckFirstUpperCamel}Dto;

/**
 * Basic ${pckFirstUpperCamel} CRUD APIs
 * @author KhanhTD
 * @Date 2023
 */
@RestController
@RequestMapping("/v1.0/ch/${pckRequestMapping}")
@Tag(name = "${pckFirstUpperCamel} Controller")
public class ${pckFirstUpperCamel}Ctrl extends BaseController {
    @Autowired
    private ${pckFirstUpperCamel}CommonService ${pckNameLower}Service;

    /**
        * Upload from request
        * @param file
        * @param data
        * @param id
        * @return
        * @throws BusinessException
    */
    @ApiOperation(value = "Api upload ${pckNameLower}")
    @PostMapping(value = "/upload")
    @ResponseBody
    public SuccessResponse<UploadFileResponse> upload(
            @Valid @RequestParam("file") MultipartFile file,
            @RequestParam("data") String data, @RequestParam(required = false) Long id) throws IOException, BusinessException {
        return RequestUtil.ok(${pckNameLower}Service.upload(file, data, id, this.getUsername()));
    }

    /**
        * Approve from request
        * @param request
        * @return
        * @throws BusinessException
    */
    @ApiOperation(value = "Api approve ${pckNameLower}")
    @PostMapping(value = "/approve")
    @ResponseBody
    public SuccessResponse<String> approve(@Valid @RequestBody ApproveRequest request) throws BusinessException {
        return RequestUtil.ok(${pckNameLower}Service.approve(request, this.getUsername(), this.getRoles()));
    }

    /**
        * Download by id
        * @param ${ettNameLower}Id
        * @return
        * @throws BusinessException
    */
    @ApiOperation(value = "Api download ${pckNameLower}")
    @GetMapping(value = "/download")
    @ResponseStatus(HttpStatus.OK)
    public Object download(@RequestParam("id") Long ${ettNameLower}Id) throws IOException, BusinessException {
        return ${pckNameLower}Service.download(${ettNameLower}Id);
    }

    /**
       * Delete by id
       * @param id ${pckNameLower}
       * @return
       * @throws BusinessException
    */
    @ApiOperation("Delete ${pckNameLower}")
    @PostMapping("/{id}/delete")
    public SuccessResponse<Object> delete(@Valid @PathVariable(value = "id") Long id) throws BusinessException {
        return RequestUtil.ok(${pckNameLower}Service.delete(id, this.getRoles()));
    }

    /**
        * Advance search ${pckNameLower}
        * @param request
        * @param page
        * @param size
        * @param sort
        * @param order
        * @return Paged ${pckNameLower}
    */
    @ApiOperation("Search ${pckFirstUpperCamel}")
    @PostMapping("/advance-search")
    public SuccessResponse<Paging<${pckFirstUpperCamel}Dto>> advanceSearch(
            @Valid @RequestBody Search${ettFirstUpperCamel}Request request,
            @PositiveOrZero @RequestParam(required = false, defaultValue = "0") @ApiParam(example = "0") Integer page,
            @Positive @RequestParam(required = false) @ApiParam(example = "10") @Max(100) Integer size,
            @RequestParam(required = false) String sort,
            @RequestParam(required = false) @ApiParam(example = "DESC") SortOrderEnum order
    ) {
        Pageable pageable = SearchUtil.getPageableFromParam(page, size, sort, order);
        return RequestUtil.ok(${pckNameLower}Service.advanceSearch(request, pageable, this.getRoles()));
    }

    /**
        * Detail ${pckNameLower}
        * @param id
        * @return ${pckNameLower}
    */
    @ApiOperation(value = "Api detail ${pckNameLower}")
    @GetMapping(value = "/{id}")
    @ResponseBody
    public SuccessResponse<${pckFirstUpperCamel}> findById(@PathVariable("id") Long id) {
        return RequestUtil.ok(${pckNameLower}Service.findById(id));
    }
}
